/*! SaVaGe 1.0 | (c) 2015 Jose F. Maldonado | LGPL license */
"object"!=typeof SaVaGe&&(SaVaGe={}),SaVaGe.CheckBox=function(e){"object"!=typeof e&&(e={}),"string"!=typeof e.container&&(e.container="body"),"number"!=typeof e.size&&(e.size=25),"number"!=typeof e.value&&(e.value=0),"object"!=typeof e.border&&(e.border={}),"number"!=typeof e.border.radius&&(e.border.radius=0),"number"!=typeof e.border.width&&(e.border.width=1),"boolean"!=typeof e.tristate&&(e.tristate=!1),"object"!=typeof e.marks&&(e.marks={}),"string"!=typeof e.marks.unchecked&&(e.marks.unchecked="empty"),"string"!=typeof e.marks.checked&&(e.marks.checked="tick"),"string"!=typeof e.marks.cancelled&&(e.marks.cancelled="cross"),"object"!=typeof e.colors&&(e.colors={}),"undefined"==typeof e.colors.back&&(e.colors.back="white"),"undefined"==typeof e.colors.border&&(e.colors.border="black"),"undefined"==typeof e.colors.tick&&(e.colors.tick="black"),"undefined"==typeof e.colors.cross&&(e.colors.cross="black"),"undefined"==typeof e.colors.fill&&(e.colors.fill="black");var r=0,t=d3.select(e.container).append("svg").attr("width",e.size+2*e.border.width).attr("height",e.size+2*e.border.width).style("cursor","pointer"),o=(t.append("rect").attr("x",e.border.width).attr("y",e.border.width).attr("rx",e.border.radius).attr("ry",e.border.radius).style("fill",e.colors.back).style("stroke",e.colors.border).style("stroke-width",e.border.width).attr("width",e.size).attr("height",e.size),null),i=function(i){r=e.tristate?i%3:i%2,null!==o&&o.remove();var s=null;if(s=0===r?e.marks.unchecked:1===r?e.marks.checked:e.marks.cancelled,"empty"===s)o=null;else if("tick"===s){var d=parseInt(e.size/5,10);2>d&&(d=2);var a=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),n=[{x:e.border.width+e.size-d/2,y:e.border.width+d/2},{x:e.border.width+parseInt(e.size/3),y:e.border.width+e.size-d/1.4},{x:e.border.width+d/2,y:e.border.width+parseInt(2*e.size/3)}];o=t.append("path").attr("d",a(n)).attr("stroke",e.colors.tick).attr("stroke-width",d).attr("fill","none")}else if("cross"===s){var d=parseInt(e.size/5,10);2>d&&(d=2),o=t.append("g"),o.append("line").attr("x1",e.border.width+d/2).attr("y1",e.border.width+d/2).attr("x2",e.border.width+e.size-d/2).attr("y2",e.border.width+e.size-d/2).style("stroke",e.colors.cross).style("stroke-width",d),o.append("line").attr("x1",e.border.width+e.size-d/2).attr("y1",e.border.width+d/2).attr("x2",e.border.width+d/2).attr("y2",e.border.width+e.size-d/2).style("stroke",e.colors.cross).style("stroke-width",d)}else if("fill"===s){var c=parseInt(e.size/10,10);1>c&&(c=1),o=t.append("rect").attr("x",e.border.width+c).attr("y",e.border.width+c).attr("rx",e.border.radius).attr("ry",e.border.radius).style("fill",e.colors.fill).attr("width",e.size-2*c).attr("height",e.size-2*c)}};i(e.value);var s={svg:t,getValue:function(){return r},setValue:i,remove:function(){t.remove()}};return t.on("click",function(){i(r+1),"function"==typeof e.onChange&&e.onChange(s)}),s};